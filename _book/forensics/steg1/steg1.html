<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Steganography 1 | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="..\../forensics/filecarving1/filecarving1.html" />
    
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../../gitbook/style.css">


        
    <div class="book"  data-level="3.1" data-basepath="..\.." data-revision="1420609538851">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="..\../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="0.1" data-path="SUMMARY.html">
            
                
                    <a href="..\../SUMMARY.html">
                        <i class="fa fa-check"></i>
                        
                            <b>0.1.</b>
                        
                         TOC
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Club Items</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="home/constitution/constitution.html">
            
                
                    <a href="..\../home/constitution/constitution.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Constitution
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="home/calendar/calendar.html">
            
                
                    <a href="..\../home/calendar/calendar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Calendar
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Web</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="web/sql1/sql1.html">
            
                
                    <a href="..\../web/sql1/sql1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         SQL 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="web/sql2/sql2.html">
            
                
                    <a href="..\../web/sql2/sql2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         SQL 2
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> Forensics</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="3.1" data-path="forensics/steg1/steg1.html">
            
                
                    <a href="..\../forensics/steg1/steg1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Steganography 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="forensics/filecarving1/filecarving1.html">
            
                
                    <a href="..\../forensics/filecarving1/filecarving1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         File Carving 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="forensics/filestructure/filestructure.html">
            
                
                    <a href="..\../forensics/filestructure/filestructure.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         File Structure
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.4" data-path="forensics/filesystem1/filesystem1.html">
            
                
                    <a href="..\../forensics/filesystem1/filesystem1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                         File System 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> Hardware</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="hardware/computer_hardware_1/computerhardware1.html">
            
                
                    <a href="..\../hardware/computer_hardware_1/computerhardware1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Computer Hardware 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> Software</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="5.1" data-path="software/blender1/blender1.html">
            
                
                    <a href="..\../software/blender1/blender1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                         Blender 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2" data-path="software/blender2/blender2.html">
            
                
                    <a href="..\../software/blender2/blender2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                         Blender 2
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.3" data-path="software/linux1/linux1.html">
            
                
                    <a href="..\../software/linux1/linux1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                         Linux 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Binary</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="6.1" data-path="binary/overflow1/overflow1.html">
            
                
                    <a href="..\../binary/overflow1/overflow1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                         Overflow 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6.2" data-path="binary/overflow2/overflow2.html">
            
                
                    <a href="..\../binary/overflow2/overflow2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                         Overflow 2
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="..\../" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_405">
                    
                        <h1 id="steganography-1">Steganography 1</h1>
<p><img src="header.png" alt="" title="Figure 1: Do you see a difference?">
<img src="header_s.png" alt="" title="Figure 1: Do you see a difference?"></p>
<h3 id="what-is-steganography">What is Steganography?</h3>
<p>What exactly is steganography? Steganography is the art of concealing information. Unlike cryptography, steganography does not stand out. Take a look at the two images above. The first one is the original image but the second one contains the hidden message <strong>&#39;Do you notice the subtle difference?&#39;</strong> The difference is definitely not noticeable by the human eye. Now let&#39;s look at an encrypted version of the same message.</p>
<pre><code>Gcwco acmqei moi kocmwi gqkkiiiaei?
</code></pre><p>The message above was encoded using Vigenére Autokey and the message itself as a password. Notice how blatantly it begs to be solved.</p>
<h3 id="image-steganography">Image Steganography</h3>
<p>In steganography 1, we will be focusing on image steganography. Before we even get to how the information is hidden, we need to understand how the message carriers (the images) function. There are four main types of images: JPEG, GIF, BMP, and PNG.</p>
<p><strong>JPEG</strong> (extension .jpg) uses lossy compression methods to make the image size smaller. It is the most common format for photos and pictures. JPEG supports 8-bit grayscale to 24-bit color images. The quality of JPEGs slowly decrease the more times you edit it and save it.</p>
<p><strong>GIF</strong> (extension .gif) is limited to 8-bit (256 colors). But hey, it supports animation.</p>
<p><strong>BMP</strong> (extension .bmp) is Microsoft Window&#39;s graphic file format. BMPs are not compressed.</p>
<p><strong>PNG</strong> (extension .png) is the alternative to GIF. It supports 8-bit (with optional transparency), 24-bit, or even 48-bit (which becomes 64-bit with the alpha channel). PNGs are widely used due to it&#39;s transparency capability.</p>
<h3 id="bits-and-bytes">Bits and Bytes</h3>
<p>You&#39;re probably frustrating over this concept of a &quot;bit&quot; right now if you&#39;ve never studied image color depth. Let&#39;s start with the basics. First of all, what is a bit? A bit is the most basic unit of information in computing. It can either be a 0 or a 1. A byte on the other hand, is a group of bits (usually 8). Most image formats apply compression and peculiar storage formats. We cannot determine pixel values just by looking at a hex editor :p. If you look at the image below, would you be able to tell that it is a blank 100x100 bmp without spending a lot of time manually decoding it? Probably not.</p>
<p><img src="hexeditor.png" alt="" title="Figure 2: A blank bmp image in HxD"></p>
<p>Have you ever looked at a hex editor before? You may have noticed how hex values are grouped in pairs. The reason for this is our human defined definition of a byte.</p>
<script type="math/tex; mode=display">(AA)_{16} = (170)_{10} = (10101010)_{2}</script><p>Similarly in Python as:</p>
<pre><code>0xAA = 170 = 0b10101010
</code></pre><p>0xAA (where 0x defines the start of a hexadecimal number in python) is equivalent to the number 170 (in base 10) which is also equivalent to 0b10101010 (where 0b defines the start of a binary). If you are not familiar with hexadecimal or binary, please study them before proceeding.</p>
<p>Do you notice that the binary contains contains 8 bits? Gasp. It appears that a byte, the basic unit of grouping, is described by a two digit hexadecimal number or an 8 bit binary.</p>
<h3 id="color-depth">Color Depth</h3>
<p>The aforementioned 8-bit, 24-bit, and 48-bit refer to the color depth of the image. In the previous subsection, we took a look at the byte. Notice that color depth only go as low as 8-bit (or 1 byte). Now is the time to pull out some of those artistic knowledge that I know most of you who actually read this do not have. Most image formats store colors in an additive format, making the primary colors red, green, and blue. From now on, they will be referred to as R, G, and B. This is different from the subtractive combination of colors that printers often use (cyan, magenta, and yellow). You may have seen from paint of other photo editing tools that these R, G, and B values range only from 0 - 255. That is because most normal color depth images only use 1 byte to store a color.</p>
<pre><code>Minimum value: 0x00 = 0b00000000 = 0
Maximum value: 0xFF = 0b11111111 = 255
</code></pre><p>For 8-bit images, that one byte has to store all three values (thus the horrific 256 colors). 24-bit JPGs use one byte for each R, G, and B color value. I hope you have now made the connection that it&#39;s called 24-bit because 3*8 = 24. PNGs and other transparency capable formats are slightly different. They can have an addition alpha channel (A) that defines the opacity of the pixel. R, G, B, and A makes a PNG 32-bit. Finally, we have the ultra high 48-bit and 64-bit color depths. Those contain millions of colors because each R, G, B, and A value take up 2 bytes (16 bits) rather than 1 byte. This is detailed below.</p>
<pre><code>8-bit:
(R + G + B) = 8 bits
R = 3 bits
G = 3 bits
B = 2 bits
Transparency extra.
Total of 256 colors.

16-bit:
(R + G + B + A) = 16 bits
Each 4 bits.
Transparency optional.
Total of 4096 colors and 16 levels of transparency.

24-bit:
(R + G + B) = 24 bits
Each 8 bits.
No transparency.
Total of 16777216 colors.

32-bit:
(R + G + B + A) = 32 bits
Each 8 bits.
Transparency optional.
Total of 16777216 colors and 256 levels of transparency.

48-bit:
(R + G + B) = 48 bits
Each 16 bits.
No transparency.
Total of 4096^3 colors.

64-bit:
(R + G + B + A) = 64 bits
Each 16 bits.
Transparency optional.
Total of 4096^3 colors and 4096 levels of transparency.
</code></pre><p>Yes. This is pertinent to what we are about to learn and do.</p>
<h3 id="least-significant-bit">Least Significant Bit</h3>
<p>The least significant bit (LSB) is the most important when it comes to steganography. Why is it called &quot;least significant&quot; then? The LSB is the last or trailing bit in a byte. Changing the LSB would make no significant changes to the image data. Don&#39;t believe me? Asking why we don&#39;t use the most significant bit (MSB) for steganography? I&#39;ll show it to you mathematically and visually.</p>
<pre><code class="lang-python"><span class="hljs-prompt">&gt;&gt;&gt; </span>int(<span class="hljs-string">'0b11111111'</span>, <span class="hljs-number">2</span>) - int(<span class="hljs-string">'0b11111110'</span>, <span class="hljs-number">2</span>)
<span class="hljs-number">1</span> <span class="hljs-comment">#Difference from changing the LSB</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>int(<span class="hljs-string">'0b11111111'</span>, <span class="hljs-number">2</span>) - int(<span class="hljs-string">'0b01111111'</span>, <span class="hljs-number">2</span>)
<span class="hljs-number">128</span> <span class="hljs-comment">#Difference from changing the MSB</span>
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:center">Original</th>
<th>LSB</th>
<th style="text-align:center">MSB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="original.png" alt="" title="Figure 3: Original"></td>
<td><img src="lsb_s.png" alt="" title="Figure 3: LSB"></td>
<td style="text-align:center"><img src="msb_s.png" alt="" title="Figure 3: MSB"></td>
</tr>
</tbody>
</table>
<p>The Python up there shows that changing the LSB will only modify a pixel&#39;s R, G, or B value by 1 while an MSB change will modify it by over 100. If mathematics didn&#39;t do it, I&#39;m sure the visual did. When we want to hide data, all we need to is convert it into binary and replace the LSB of each R, G, B, (or A) with a bit of the data. We will discuss this more later. Notice that if steganography used MSB or something that&#39;s not LSB, the difference will be much more noticeable. The message hidden was: &#39;Do you notice the difference? Yeah. I think you notice the difference now. Why? Because I told you that LSB is the least significant and will not cause a lot of change to the image.</p>
<h3 id="not-unlimited">Not Unlimited</h3>
<p>Remember when I said that color depth is pertinent to steganography? I am about to explain why. Before you hide data in something, you&#39;ll probably want to make sure that it can actually store everything and not run out of storage space :p. This is where color depth comes in. Each pixel in an 8-bit image contains 8 bits (if you haven&#39;t figured that out yet). Each 8 bits or byte can store one bit of information using LSB. That means a 24-bit JPG has the capacity to store 3 bits of information per pixel. The maximum storage capacity of a carrier can be defined as:</p>
<script type="math/tex; mode=display">capacity = width \times height \times \dfrac{bitdepth}{8}</script><h3 id="putting-it-together">Putting It Together</h3>
<p>We can put all that we&#39;ve learned into play to actually perform steganography. There are many steganography tools available. Some of those tools do not utilize LSB to hide information. No, they don&#39;t use MSB. They use other more complex algorithms. We will take a look at the text steganography portion of a Python stegnography module called Stéganô. I&#39;ve rewritten and combined important parts of the code so I can explain how the they work. Let&#39;s look at how we can hide information in images. The code below comes from the file <a href="hide.py">hide.py</a> (a better custom version that fixes a bug is available for download in a later section).</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setlsb</span><span class="hljs-params">(component, bit)</span>:</span>
    <span class="hljs-keyword">return</span> component &amp; ~<span class="hljs-number">1</span> | int(bit)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">a2bits_list</span><span class="hljs-params">(chars)</span>:</span>
    <span class="hljs-keyword">return</span> [bin(ord(x))[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">8</span>, <span class="hljs-string">'0'</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> chars]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hide</span><span class="hljs-params">(input_image_file, message)</span>:</span>

    img = Image.open(input_image_file)
    encoded = img.copy()
    width, height = img.size
    index = <span class="hljs-number">0</span>

    message = str(len(message)) + <span class="hljs-string">":"</span> + message
    message_bits = <span class="hljs-string">""</span>.join(a2bits_list(message))

    npixels = width * height
    <span class="hljs-keyword">if</span> len(message_bits) &gt; npixels * <span class="hljs-number">3</span>:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"""The message you want to hide is too long (%s &gt; %s)."""</span> % (len(message_bits), npixels * <span class="hljs-number">3</span>))

    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(height):
        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> range(width):

            <span class="hljs-keyword">if</span> index + <span class="hljs-number">3</span> &lt;= len(message_bits) :

                (r, g, b) = img.getpixel((col, row))

                r = setlsb(r, message_bits[index])
                g = setlsb(g, message_bits[index+<span class="hljs-number">1</span>])
                b = setlsb(b, message_bits[index+<span class="hljs-number">2</span>])

                encoded.putpixel((col, row), (r, g , b))

            index += <span class="hljs-number">3</span>

    <span class="hljs-keyword">return</span> encoded

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    steg = hide(<span class="hljs-string">'carrier.png'</span>, <span class="hljs-string">'The secret message.'</span>)
    steg.save(<span class="hljs-string">'output.png'</span>)
</code></pre>
<p>We can begin analyzing this script line by line.</p>
<h3 id="python-importing-pil">Python: Importing PIL</h3>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
</code></pre>
<p>First we need to import Image from the PIL library. If you don&#39;t have it yet, you can get it by running the following in CMD or terminal:</p>
<pre><code>pip3 install pillow
</code></pre><h3 id="setting-the-lsb">Setting the LSB</h3>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setlsb</span><span class="hljs-params">(component, bit)</span>:</span>
    <span class="hljs-keyword">return</span> component &amp; ~<span class="hljs-number">1</span> | int(bit)
</code></pre>
<p>The function takes in an R, G, or B value as <strong>component</strong> and the bit to be hidden as <strong>bit</strong>. The function uses a smart bitwise method to alter the LSB of the component and return it as an integer value. Let&#39;s look at how it works. If you forgot bitwise operations, please review that concept.</p>
<p>Component is 201 and the bit we are trying to hide is 1.</p>
<pre><code class="lang-python"><span class="hljs-prompt">&gt;&gt;&gt; </span>component = int(<span class="hljs-number">201</span>) <span class="hljs-comment">#Set component value to 201</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>bin(component) <span class="hljs-comment">#Binary of component</span>
<span class="hljs-string">'0b11001001'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>component &amp; ~<span class="hljs-number">1</span> <span class="hljs-comment">#Set the last bit to 0</span>
<span class="hljs-number">200</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>component &amp; int(<span class="hljs-string">'0b11111110'</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">#Another way to set the last bit to 0</span>
<span class="hljs-number">200</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>bin = int(<span class="hljs-number">1</span>)
<span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-number">200</span> | <span class="hljs-number">1</span> <span class="hljs-comment">#Set the LSB to the bin value</span>
<span class="hljs-number">201</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-number">200</span> | (int(<span class="hljs-string">'0b00000001'</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">#Another way to do set the LSB data</span>
<span class="hljs-number">201</span>

Converting to Binary

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">a2bits_list</span><span class="hljs-params">(chars)</span>:</span>
    <span class="hljs-keyword">return</span> [bin(ord(x))[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">8</span>, <span class="hljs-string">'0'</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> chars]
</code></pre>
<p>The function takes the ASCII value of each character, converts it into an 8 bit binary, and appends it to the list. The return operation is simplified to a one line list comprehension. The function can be rewritten as the following.</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">a2bits_list</span><span class="hljs-params">(chars)</span>:</span>
    list = [] <span class="hljs-comment">#Create an empty list</span>
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> chars: <span class="hljs-comment">#Cycle through all characters</span>
        data = bin(ord(x))[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">8</span>, <span class="hljs-string">'0'</span>) <span class="hljs-comment">#Convert each character to binary, strip the '0b', and fill it up to 8 bits with empty 0s in the front</span>
        list.append(data) <span class="hljs-comment">#Add the data to the list</span>
    <span class="hljs-keyword">return</span> list <span class="hljs-comment">#Return the list</span>
</code></pre>
<h3 id="hiding-the-data">Hiding the Data</h3>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hide</span><span class="hljs-params">(input_image_file, message)</span>:</span>
</code></pre>
<p>Line 9: Accepts the input image file name and the message to hide.</p>
<pre><code class="lang-python">img = Image.open(input_image_file)
encoded = img.copy()
width, height = img.size
index = <span class="hljs-number">0</span>
</code></pre>
<p>Lines 11-14: Open the image and create a copy for output. Get the image size. Set pixel index to 0 (we need to know where we are in the image to know what index of the message binary to hide in the LSB.</p>
<pre><code class="lang-python">message = str(len(message)) + <span class="hljs-string">":"</span> + message
message_bits = <span class="hljs-string">""</span>.join(a2bits_list(message))
</code></pre>
<p>Lines 16-17: Get the length of the message and add it to the beginning of the message. This is done so that for non-text files, the revealer knows when to stop.</p>
<pre><code class="lang-python">npixels = width * height
<span class="hljs-keyword">if</span> len(message_bits) &gt; npixels * <span class="hljs-number">3</span>:
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"""The message you want to hide is too long (%s &gt; %s)."""</span> % (len(message_bits), npixels * <span class="hljs-number">3</span>))
</code></pre>
<p>Lines 19-21: Checks if the max length of the message exceeds the capacity of the carrier.</p>
<pre><code class="lang-python"><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(height):
    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> range(width):

        <span class="hljs-keyword">if</span> index + <span class="hljs-number">3</span> &lt;= len(message_bits) :

            (r, g, b) = img.getpixel((col, row))

            r = setlsb(r, message_bits[index])
            g = setlsb(g, message_bits[index+<span class="hljs-number">1</span>])
            b = setlsb(b, message_bits[index+<span class="hljs-number">2</span>])

            encoded.putpixel((col, row), (r, g , b))

        index += <span class="hljs-number">3</span>

<span class="hljs-keyword">return</span> encoded
</code></pre>
<p>Lines 23-38: For every pixel (it goes range(height) and then range(width) because we want to encode left-right. Think about it.), if the message has not been completely encoded, get the R, G, and B value of the pixel at the location (col, row). Set the LSB values of each R, G, and B to a bit in the message. Put the new pixel values in our encoded file (a copy of the original image). Add 3 to the index counter because we process 3 bits. Notice a problem here. It only goes by sets of 3s, which can cause incomplete data to be encoded. A fix will be shown later. Finally, return the encoded image.</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    steg = hide(<span class="hljs-string">'carrier.png'</span>, <span class="hljs-string">'The secret message.'</span>)
    steg.save(<span class="hljs-string">'output.png'</span>)
</code></pre>
<p>Lines 40-42: If the file is not being imported, use the carrier &#39;carrier.png&#39;, hide the message &#39;The secret message.&#39;, and save the output to &#39;output.png&#39;.</p>
<h3 id="bug-fix">Bug Fix</h3>
<p>The aforementioned issue of &quot;sets of 3s&quot; incomplete data hiding results when one bit of the message is left out at the end. This results from the set of three check. A fixed version is available for download - <a href="hide_fix.py">hide_fix.py</a>. Figure out what has been fixed and why the fix works.</p>
<h3 id="retrieving-the-data">Retrieving the Data</h3>
<p>Now that we have hidden the data, we want a way to get it back. Stéganô also includes a function to do that. I have simplified the source into reveal.py. The reveal function works by working on the image in 8 bit (1 byte) chunks. Therefore, it can recover the hidden messages from images of different color depths and transparency options.</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reveal</span><span class="hljs-params">(input_image_file)</span>:</span>
    img = Image.open(input_image_file)
    width, height = img.size
    buff, count = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
    bitab = []
    limit = <span class="hljs-keyword">None</span>
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(height):
        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> range(width):

            <span class="hljs-keyword">for</span> color <span class="hljs-keyword">in</span> img.getpixel((col, row)):
                buff += (color&amp;<span class="hljs-number">1</span>)&lt;&lt;(<span class="hljs-number">7</span>-count)
                count += <span class="hljs-number">1</span>
                <span class="hljs-keyword">if</span> count == <span class="hljs-number">8</span>:
                    bitab.append(chr(buff))
                    buff, count = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
                    <span class="hljs-keyword">if</span> bitab[-<span class="hljs-number">1</span>] == <span class="hljs-string">":"</span> <span class="hljs-keyword">and</span> limit == <span class="hljs-keyword">None</span>:
                        <span class="hljs-keyword">try</span>:
                            limit = int(<span class="hljs-string">""</span>.join(bitab[:-<span class="hljs-number">1</span>]))
                        <span class="hljs-keyword">except</span>:
                            <span class="hljs-keyword">pass</span>

            <span class="hljs-keyword">if</span> len(bitab)-len(str(limit))-<span class="hljs-number">1</span> == limit :
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>.join(bitab)[len(str(limit))+<span class="hljs-number">1</span>:]
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    print(reveal(<span class="hljs-string">'output.png'</span>))
</code></pre>
<h3 id="hiding-in-the-alpha-channel">Hiding in the Alpha Channel</h3>
<p>32-bit PNGs also have an 8 bit alpha channel that can be used to hide information. Below is a modified program that hides additional data in the alpha channel. reveal.py can still extract the data without modification. The code below is from rgba_steg.py.</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setlsb</span><span class="hljs-params">(component, bit)</span>:</span>
    <span class="hljs-keyword">return</span> component &amp; ~<span class="hljs-number">1</span> | int(bit)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">a2bits_list</span><span class="hljs-params">(chars)</span>:</span>
    <span class="hljs-keyword">return</span> [bin(ord(x))[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">8</span>,<span class="hljs-string">"0"</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> chars]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hide</span><span class="hljs-params">(input_image_file, message)</span>:</span>

    img = Image.open(input_image_file)
    img = img.convert(<span class="hljs-string">"RGBA"</span>)
    encoded = img.copy()
    width, height = img.size
    index = <span class="hljs-number">0</span>

    message = str(len(message)) + <span class="hljs-string">":"</span> + message
    message_bits = <span class="hljs-string">""</span>.join(a2bits_list(message))

    npixels = width * height
    <span class="hljs-keyword">if</span> len(message_bits) &gt; npixels * <span class="hljs-number">4</span>:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"""The message you want to hide is too long (%s &gt; %s)."""</span> % (len(message_bits), npixels * <span class="hljs-number">4</span>))

    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(height):
        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> range(width):

            <span class="hljs-keyword">if</span> index + <span class="hljs-number">1</span> &lt;= len(message_bits):

                (r, g, b, a) = img.getpixel((col, row))

                r = setlsb(r, message_bits[index])

                <span class="hljs-keyword">if</span> index + <span class="hljs-number">2</span> &lt;= len(message_bits):
                    g = setlsb(g, message_bits[index+<span class="hljs-number">1</span>])

                <span class="hljs-keyword">if</span> index + <span class="hljs-number">3</span> &lt;= len(message_bits):
                    b = setlsb(b, message_bits[index+<span class="hljs-number">2</span>])

                <span class="hljs-keyword">if</span> index + <span class="hljs-number">4</span> &lt;= len(message_bits):
                    a = setlsb(a, message_bits[index+<span class="hljs-number">3</span>])

                encoded.putpixel((col, row), (r, g , b, a))

            index += <span class="hljs-number">4</span>

    <span class="hljs-keyword">return</span> encoded

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    steg = hide(<span class="hljs-string">'carrier.png'</span>, <span class="hljs-string">'Hidden message.'</span>)
    steg.save(<span class="hljs-string">'output.png'</span>)
</code></pre>
<p>Now, why don&#39;t you try to extract the hidden message from the second image of the CAMS CSC logo at the top of the page?</p>
<h3 id="hiding-elsewhere">Hiding Elsewhere</h3>
<p>Is the only type of image steganography LSB? No. There are many other types of image steganography as well. Let&#39;s see a few.</p>
<h3 id="eof-steganography">EOF Steganography</h3>
<p>We can hide data after the footer of some image formats. JPG images read only from header to footer. Thus, we can safely put any data we want after the footer without disrupting the image at all. However, this method is easily detectable when viewing the contents of the file in a text editor or hex editor.</p>
<table>
<thead>
<tr>
<th style="text-align:center">Original</th>
<th style="text-align:center">With EOF Steg</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="eof.jpg" alt="" title="Figure 4: Original JPG"></td>
<td style="text-align:center"><img src="eof_s.jpg" alt="" title="Figure 4: JPG with EOF steganography"></td>
</tr>
</tbody>
</table>
<p>Let&#39;s look at how easy it is to detect EOF Steganography.</p>
<p><img src="blatanteof.png" alt="" title="Figure 5: EOF steganography viewed using HxD"></p>
<p>More steganography carriers, algorithms, and methods will be discussed in another lesson.</p>
<h3 id="further-readings-and-references">Further Readings and References</h3>
<p>&quot;Steganography: Hiding Data Within Data&quot; - <a href="http://www.garykessler.net/library/steganography.html" target="_blank">http://www.garykessler.net/library/steganography.html</a></p>
<p>Tool: Stéganô - <a href="https://bitbucket.org/cedricbonhomme/stegano" target="_blank">https://bitbucket.org/cedricbonhomme/stegano</a></p>
<p>Tool: LSB-Steganography - <a href="https://github.com/RobinDavid/LSB-Steganography" target="_blank">https://github.com/RobinDavid/LSB-Steganography</a></p>
<p>Tool: HxD - <a href="http://mh-nexus.de/en/hxd/" target="_blank">http://mh-nexus.de/en/hxd/</a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        
        <a href="..\../forensics/filecarving1/filecarving1.html" class="navigation navigation-next navigation-unique" aria-label="Next page: File Carving 1"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
